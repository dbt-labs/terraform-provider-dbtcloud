---
page_title: "dbtcloud_repository Resource - dbtcloud"
subcategory: ""
description: |-
  Manages a dbt Cloud repository.
---

# dbtcloud_repository (Resource)

This resource allows you to manage connections to git repositories in dbt Cloud.

By itself, this resource won't show you the repository in the dbt Cloud UI. 
You will need to also set up a [`dbtcloud_project_repository` resource](https://registry.terraform.io/providers/dbt-labs/dbtcloud/latest/docs/resources/project_repository) as well to link your dbt Cloud project and the git repository.

In order to find the `github_installation_id`, you can log in to dbt Cloud, replace `<dbt_cloud_url>` by your dbt Cloud
URL and run the following commands in the Google Chrome console:

```console
dbt_cloud_api_result = await (fetch('https://<dbt_cloud_url>/api/v2/integrations/github/installations/').then(res => res.json()));
console.log("github_application_id: " + dbt_cloud_api_result.filter(res => res["access_tokens_url"].includes("github"))[0]["id"]);
```

Alternatively, you can go to the page `https://<dbt_cloud_url>/api/v2/integrations/github/installations/` and read the
value of `id`  or use the `http` provider to retrieve it automatically like in the example below.

## Example Usage

```terraform
### repo cloned via the GitHub integration, manually entering the `github_installation_id`
resource "dbtcloud_repository" "github_repo" {
  project_id             = dbtcloud_project.dbt_project.id
  remote_url             = "git@github.com:<github_org>/<github_repo>.git"
  github_installation_id = 9876
  git_clone_strategy     = "github_app"
}


### repo cloned via the GitHub integration, with auto-retrieval of the `github_installation_id`
# here, we assume that `token` and `host_url` are respectively accessible via `var.dbt_token` and `var.dbt_host_url`
# NOTE: the following requires connecting via a user token and can't be retrieved with a service token
data "http" "github_installations_response" {
  url = format("%s/v2/integrations/github/installations/", var.dbt_host_url)
  request_headers = {
    Authorization = format("Bearer %s", var.dbt_token)
  }
}

locals {
  github_installation_id = jsondecode(data.http.github_installations_response.response_body)[0].id
}

resource "dbtcloud_repository" "github_repo_other" {
  project_id             = dbtcloud_project.dbt_project.id
  remote_url             = "git@github.com:<github_org>/<github_repo>.git"
  github_installation_id = local.github_installation_id
  git_clone_strategy     = "github_app"
}


### repo cloned via the GitLab integration
# as of 15 Sept 2023 this resource requires using a user token and can't be set with a service token - CC-791
resource "dbtcloud_repository" "gitlab_repo" {
  project_id         = dbtcloud_project.dbt_project.id
  remote_url         = "<gitlab-group>/<gitlab-project>"
  gitlab_project_id  = 8765
  git_clone_strategy = "deploy_token"
}


### repo cloned via the deploy token strategy
resource "dbtcloud_repository" "deploy_repo" {
  project_id         = dbtcloud_project.dbt_project.id
  remote_url         = "git://github.com/<github_org>/<github_repo>.git"
  git_clone_strategy = "deploy_key"
}


### repo cloned via the Azure Dev Ops integration
resource "dbtcloud_repository" "ado_repo" {
  project_id = dbtcloud_project.dbt_project.id
  # the following values can be added manually (IDs can be retrieved from the ADO API) or via data sources
  # remote_url                              = "https://abc@dev.azure.com/abc/def/_git/my_repo"
  # azure_active_directory_project_id       = "12345678-1234-1234-1234-1234567890ab"
  # azure_active_directory_repository_id    = "87654321-4321-abcd-abcd-464327678642"
  remote_url                                = data.dbtcloud_azure_dev_ops_repository.my_devops_repo.remote_url
  azure_active_directory_repository_id      = data.dbtcloud_azure_dev_ops_repository.my_devops_repo.id
  azure_active_directory_project_id         = data.dbtcloud_azure_dev_ops_project.my_devops_project.id
  azure_bypass_webhook_registration_failure = false
  git_clone_strategy                        = "azure_active_directory_app"
}

### repo with private link endpoint
# You have to have a PrivateLink Endpoint available in the dropdown in the dbt cloud app under Project/ New repository modal, under Git Clone with PrivateLink Endpoint selected.
resource "dbtcloud_repository" "ado_repo" {
  project_id = dbtcloud_project.dbt_project.id
  remote_url = "git@github.somecorp.com:username/terraform-provider.git"
  private_link_endpoint_id = "<private_link_endpoint_id>"
  pull_request_url_template = "https://github.somecorp.com/username/terraform-provider/revert2/{{destination}}...{{source}}"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `project_id` (Number) Project ID to create the repository in
- `remote_url` (String) Git URL for the repository or \<Group>/\<Project> for Gitlab

### Optional

- `azure_active_directory_project_id` (String) The Azure Dev Ops project ID. It can be retrieved via the Azure API or using the data source `dbtcloud_azure_dev_ops_project` and the project name - (required for ADO native integration only)
- `azure_active_directory_repository_id` (String) The Azure Dev Ops repository ID. It can be retrieved via the Azure API or using the data source `dbtcloud_azure_dev_ops_repository` along with the ADO Project ID and the repository name - (required for ADO native integration only)
- `azure_bypass_webhook_registration_failure` (Boolean) If set to False (the default), the connection will fail if the service user doesn't have access to set webhooks (required for auto-triggering CI jobs). If set to True, the connection will be successful but no automated CI job will be triggered - (for ADO native integration only)
- `fetch_deploy_key` (Boolean, Deprecated) Whether we should return the public deploy key - (for the `deploy_key` strategy)
- `git_clone_strategy` (String) Git clone strategy for the repository. Can be `deploy_key` (default) for cloning via SSH Deploy Key, `github_app` for GitHub native integration, `deploy_token` for the GitLab native integration and `azure_active_directory_app` for ADO native integration
- `github_installation_id` (Number) Identifier for the GitHub App - (for GitHub native integration only)
- `gitlab_project_id` (Number) Identifier for the Gitlab project -  (for GitLab native integration only)
- `is_active` (Boolean) Whether the repository is active
- `private_link_endpoint_id` (String) Identifier for the PrivateLink endpoint.
- `pull_request_url_template` (String) URL template for creating a pull request. If it is not set, the default template will create a PR from the current branch to the branch configured in the Development environment.

### Read-Only

- `deploy_key` (String) Public key generated by dbt when using `deploy_key` clone strategy
- `id` (String) The ID of this resource
- `repository_credentials_id` (Number) Credentials ID for the repository (From the repository side not the dbt Cloud ID)
- `repository_id` (Number) Repository Identifier

## Import

Import is supported using the following syntax:

```shell
# using  import blocks (requires Terraform >= 1.5)
import {
  to = dbtcloud_repository.my_repository
  id = "project_id:repository_id"
}

import {
  to = dbtcloud_repository.my_repository
  id = "12345:6789"
}

# using the older import command
terraform import dbtcloud_repository.my_repository "project_id:repository_id"
terraform import dbtcloud_repository.my_repository 12345:6789
```
